<!DOCTYPE html>
<html lang="ne">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1">
<title>рд╕рдВрдХреНрд╖рд┐рдкреНрдд рд╡рд┐рд╡рд░рдг | FarmerBase BP Engine</title>

<style>
*{box-sizing:border-box}
body{
  margin:0;
  font-family:system-ui,-apple-system,Segoe UI,Roboto;
  background:#f6f7f9;
  color:#222;
}
:root{
  --w:980px;
  --g:#1b5e20;
  --b:#e0e0e0;
}

/* Header */
header{
  position:sticky; top:0; z-index:10;
  background:#fff;
  border-bottom:1px solid var(--b);
}
.h-wrap{
  max-width:var(--w);
  margin:auto;
  padding:10px 14px;
  display:flex; align-items:center; justify-content:space-between;
}
.brand{font-weight:700;color:var(--g);font-size:14px}
.biz-name select{
  font-size:12px;padding:4px 6px;border-radius:6px;border:1px solid #ccc;
}

/* Page */
.main{
  max-width:var(--w);
  margin:18px auto 24px;
  padding:0 14px;
}
.card{
  background:#fff;
  border:1px solid var(--b);
  border-radius:8px;
  margin-bottom:16px;
}
.card h3{
  margin:0;padding:10px 12px;
  font-size:14px;
  background:#f3f5f7;
  border-bottom:1px solid var(--b);
}
.card .body{padding:12px}

/* Form */
.row{
  display:grid;gap:10px;
  grid-template-columns:repeat(12,1fr);
  margin-bottom:10px
}
.col-6{grid-column:span 6}
.col-4{grid-column:span 4}
.col-3{grid-column:span 3}
label{font-size:12px;color:#444}
input,select{
  width:100%;padding:8px 9px;
  font-size:13px;border:1px solid #ccc;
  border-radius:6px;background:#fff;
}

/* Toggle */
.toggle{display:inline-flex;border:1px solid #ccc;border-radius:20px;overflow:hidden}
.toggle button{
  border:0;padding:6px 10px;font-size:12px;
  cursor:pointer;background:#fff
}
.toggle button.active{background:#e8f5e9;color:var(--g)}

/* Footer */
.footer-nav{
  display:flex;justify-content:space-between;align-items:center;
  padding:10px 14px;border-top:1px solid var(--b);
  background:#fff;position:sticky;bottom:0
}
.status{font-size:12px;color:#2e7d32}
.btn{
  padding:8px 12px;border-radius:6px;
  font-size:13px;cursor:pointer;
  border:1px solid #ccc;background:#fafafa
}
.btn.primary{background:var(--g);color:#fff;border-color:var(--g)}
.btn[disabled]{opacity:.5;cursor:not-allowed}

/* Responsive */
@media(max-width:720px){
  .col-6,.col-4,.col-3{grid-column:span 12}
}
</style>
</head>

<body>

<header>
  <div class="h-wrap">
    <div class="brand">FarmerBase BP Engine</div>
    <div class="biz-name">
      <select id="businessSwitcher"></select>
    </div>
  </div>
</header>

<main class="main">

<!-- Business -->
<section class="card">
<h3>ЁЯУМ рд╡реНрдпрд╡рд╕рд╛рдпрдХреЛ рдЖрдзрд╛рд░рднреВрдд рдЬрд╛рдирдХрд╛рд░реА</h3>
<div class="body">
<div class="row">
  <div class="col-6">
    <label>рд╡реНрдпрд╡рд╕рд╛рдпрдХреЛ рдирд╛рдо *</label>
    <input id="businessName">
  </div>
  <div class="col-6">
    <label>рд╡реНрдпрд╡рд╕рд╛рдпрдХреЛ рдкреНрд░рдХрд╛рд░</label>
    <select id="businessType">
      <option>рдХреГрд╖рд┐</option><option>рдкрд╢реБрдкрд╛рд▓рди</option>
      <option>рд╡реНрдпрд╛рдкрд╛рд░</option><option>рд╕реЗрд╡рд╛</option>
    </select>
  </div>
</div>
</div>
</section>

<!-- Address -->
<section class="card">
<h3>ЁЯУН рдареЗрдЧрд╛рдирд╛ рд╡рд┐рд╡рд░рдг</h3>
<div class="body">
<div class="row">
  <div class="col-3"><label>рдкреНрд░рджреЗрд╢</label><select id="province"></select></div>
  <div class="col-3"><label>рдЬрд┐рд▓реНрд▓рд╛</label><select id="district"></select></div>
  <div class="col-3"><label>рди.рдкрд╛./рдЧрд╛.рдкрд╛.</label><input id="municipality"></div>
  <div class="col-3"><label>рд╡рдбрд╛ рдирдВ.</label><input id="ward"></div>
</div>
</div>
</section>

<!-- Preferences -->
<section class="card">
<h3>тЪЩя╕П рдкреНрд░рд╛рдердорд┐рдХрддрд╛</h3>
<div class="body">
<div class="row">
  <div class="col-4">
    <label>рднрд╛рд╖рд╛</label><br>
    <div class="toggle" id="langToggle">
      <button class="active" data-v="np">рдиреЗрдкрд╛рд▓реА</button>
      <button data-v="en">English</button>
    </div>
  </div>
  <div class="col-4">
    <label>рдореБрджреНрд░рд╛</label><br>
    <div class="toggle" id="curToggle">
      <button class="active" data-v="NPR">рдиреЗ.рд░реБ.</button>
      <button data-v="USD">USD</button>
    </div>
  </div>
</div>
</div>
</section>

</main>

<div class="footer-nav">
  <div class="status" id="saveStatus">рдЕрдиреНрддрд┐рдо рд╕реЗрдн: тАФ</div>
  <div>
    <button class="btn" onclick="location.href='index.html'">тмЕ рдкрдЫрд╛рдбрд┐</button>
    <button class="btn primary" id="continueBtn" disabled>рдЕрдЧрд╛рдбрд┐ рдмрдвреНрдиреБрд╣реЛрд╕реН тЮЬ</button>
  </div>
</div>

<script>
/* ===== Province тЖТ District ===== */
const NEPAL_P_D={
"рдмрд╛рдЧрдорддреА":["рдХрд╛рдардорд╛рдбреМрдБ","рд▓рд▓рд┐рддрдкреБрд░","рднрдХреНрддрдкреБрд░","рдиреБрд╡рд╛рдХреЛрдЯ","рд░рд╕реБрд╡рд╛","рдзрд╛рджрд┐рдЩ","рдЪрд┐рддрд╡рди"],
"рдЧрдгреНрдбрдХреА":["рдХрд╛рд╕реНрдХреА","рдЧреЛрд░рдЦрд╛","рд▓рдордЬреБрдЩ"],
"рд▓реБрдореНрдмрд┐рдиреА":["рд░реБрдкрдиреНрджреЗрд╣реА","рджрд╛рдЩ","рдмрд╛рдБрдХреЗ"],
"рдХрд░реНрдгрд╛рд▓реА":["рд╕реБрд░реНрдЦреЗрдд","рдЬреБрдореНрд▓рд╛"],
"рд╕реБрджреВрд░рдкрд╢реНрдЪрд┐рдо":["рдХреИрд▓рд╛рд▓реА","рдХрдЮреНрдЪрдирдкреБрд░"]
};
const province=document.getElementById("province");
const district=document.getElementById("district");
province.innerHTML='<option value="">рдкреНрд░рджреЗрд╢</option>'+Object.keys(NEPAL_P_D).map(p=>`<option>${p}</option>`).join("");
province.onchange=()=>{
 district.innerHTML='<option value="">рдЬрд┐рд▓реНрд▓рд╛</option>';
 (NEPAL_P_D[province.value]||[]).forEach(d=>district.innerHTML+=`<option>${d}</option>`);
 save();
};

/* ===== Business Registry ===== */
const $=id=>document.getElementById(id);
function getBiz(){return JSON.parse(localStorage.getItem("fb_businesses")||'{"list":{}}')}
function setBiz(b){localStorage.setItem("fb_businesses",JSON.stringify(b))}
let B=getBiz();
if(!B.activeId){
 const id="b"+Date.now();
 B.activeId=id;B.list[id]={name:""};setBiz(B);
}
const BID=B.activeId,KEY="fb_business_info_"+BID;

/* Switcher */
function loadSwitcher(){
 const s=$("businessSwitcher");s.innerHTML="";
 Object.entries(B.list).forEach(([id,v])=>{
  s.innerHTML+=`<option value="${id}" ${id===BID?"selected":""}>${v.name||"рдирд╛рдо рдирднрдПрдХреЛ рд╡реНрдпрд╡рд╕рд╛рдп"}</option>`;
 });
 s.innerHTML+=`<option value="__new__">тЮХ рдирдпрд╛рдБ рд╡реНрдпрд╡рд╕рд╛рдп</option>`;
}
$("businessSwitcher").onchange=e=>{
 if(e.target.value==="__new__"){
  const id="b"+Date.now();B.list[id]={name:""};B.activeId=id;setBiz(B);location.reload();
 }else{B.activeId=e.target.value;setBiz(B);location.reload();}
};
loadSwitcher();

/* Save / Load */
function collect(){
 return{
  name:$("businessName").value,
  type:$("businessType").value,
  address:{province:province.value,district:district.value},
  pref:{
   lang:document.querySelector("#langToggle .active").dataset.v,
   cur:document.querySelector("#curToggle .active").dataset.v
  }
 };
}
function save(){
 const d=collect();localStorage.setItem(KEY,JSON.stringify(d));
 B.list[BID].name=d.name;setBiz(B);
 $("saveStatus").textContent="рдЕрдиреНрддрд┐рдо рд╕реЗрдн: тЬФ";
 $("continueBtn").disabled=!d.name;
}
document.querySelectorAll("input,select").forEach(e=>{
 e.oninput=save;e.onchange=save;
});

/* Toggle */
document.querySelectorAll(".toggle button").forEach(b=>{
 b.onclick=()=>{
  b.parentElement.querySelectorAll("button").forEach(x=>x.classList.remove("active"));
  b.classList.add("active");save();
 };
});

/* Load */
const raw=localStorage.getItem(KEY);
if(raw){
 const d=JSON.parse(raw);
 $("businessName").value=d.name||"";
 $("businessType").value=d.type||"";
 province.value=d.address?.province||"";
 if(province.value){
  province.onchange();
  district.value=d.address?.district||"";
 }
}

/* Continue */
$("continueBtn").onclick=()=>location.href="existing-status.html";
</script>

</body>
</html>
