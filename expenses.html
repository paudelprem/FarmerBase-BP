<!DOCTYPE html>
<html lang="ne">
<head>
<meta charset="UTF-8">
<title>Expenses</title>

<style>
/* ====== BASIC ====== */
body {
  font-family: Arial, sans-serif;
  padding: 20px;
}
h2 { margin: 0; }

/* ====== HEADER ====== */
.bp-header {
  border-bottom: 2px solid #e0e0e0;
  margin-bottom: 15px;
  padding-bottom: 8px;
}
.bp-sub {
  font-size: 14px;
  color: #555;
}

/* ====== TABLE ====== */
table {
  width: 100%;
  border-collapse: collapse;
  margin-top: 10px;
}
th, td {
  border: 1px solid #ccc;
  padding: 8px;
  text-align: center;
}
th {
  background: #f3f3f3;
}

/* ====== ENTRY ROW ====== */
.entry-row {
  background: #fafafa;
}
.input {
  width: 100%;
  padding: 7px;
  font-size: 14px;
}
.input:disabled {
  background: #eee;
}

/* ====== MAPPING ====== */
.map-box {
  display: flex;
  align-items: center;
  justify-content: center;
  gap: 6px;
}
.map-arrow {
  font-size: 18px;
  color: #2e7d32;
  font-weight: bold;
}
.percent {
  width: 70px;
}

/* ====== BUTTONS ====== */
.btn {
  padding: 6px 14px;
  cursor: pointer;
  border-radius: 4px;
  font-size: 14px;
  border: none;
}
.btn-save {
  background: #2e7d32;
  color: #fff;
}
.btn-edit {
  background: #0277bd;
  color: #fff;
}
.btn-del {
  background: #c62828;
  color: #fff;
}

/* ====== HINT ====== */
.page-hint {
  background: #f9fbe7;
  padding: 8px;
  font-size: 14px;
  margin-bottom: 10px;
}
</style>
</head>

<body>

<!-- ===== HEADER ===== -->
<div class="bp-header">
  <h2 id="businessName">‡§¨‡§Ç‡§ó‡•Å‡§∞ ‡§™‡§æ‡§≤‡§® ‡§µ‡•ç‡§Ø‡§µ‡§∏‡§æ‡§Ø</h2>
  <p class="bp-sub">Business Plan ‚Üí ‡§ñ‡§∞‡•ç‡§ö ‡§µ‡§ø‡§µ‡§∞‡§£ (Expenses)</p>
</div>

<p class="page-hint">
  üí° ‡§Ø‡§π‡§æ‡§Å ‡§ó‡§∞‡§ø‡§è‡§ï‡•ã ‡§ñ‡§∞‡•ç‡§ö ‡§∏‡•ç‡§µ‡§§‡§É ‡§∏‡§Æ‡•ç‡§¨‡§®‡•ç‡§ß‡§ø‡§§ ‡§â‡§§‡•ç‡§™‡§æ‡§¶‡§®‡§ï‡•ã ‡§≤‡§æ‡§ó‡§§‡§Æ‡§æ ‡§ú‡•ã‡§°‡§ø‡§®‡•ç‡§õ
</p>

<!-- ===== ENTRY TABLE ===== -->
<table>
<thead>
<tr>
  <th>‡§ñ‡§∞‡•ç‡§ö ‡§∂‡•Ä‡§∞‡•ç‡§∑‡§ï</th>
  <th>‡§™‡•ç‡§∞‡§ï‡§æ‡§∞</th>
  <th>‡§∞‡§ï‡§Æ</th>
  <th>‡§Ü‡§Ø‡•Å (‡§µ‡§∞‡•ç‡§∑)</th>
  <th colspan="2">‡§ï‡•Å‡§® ‡§â‡§§‡•ç‡§™‡§æ‡§¶‡§®‡§Æ‡§æ ‡§ñ‡§∞‡•ç‡§ö ?</th>
  <th>Action</th>
</tr>
</thead>

<tbody class="entry-row">
<tr>
  <td><input class="input" id="title" placeholder="‡§ú‡§∏‡•ç‡§§‡•à: ‡§¶‡§æ‡§®‡§æ ‡§ñ‡§∞‡•ç‡§ö"></td>

  <td>
    <select class="input" id="type" onchange="toggleLife()">
      <option value="variable">‡§ö‡§æ‡§≤‡•Å</option>
      <option value="fixed">‡§∏‡•ç‡§•‡§ø‡§∞</option>
    </select>
  </td>

  <td><input class="input" type="number" id="amount"></td>

  <td>
    <input class="input" type="number" id="life" placeholder="‡§∏‡•ç‡§•‡§ø‡§∞‡§Æ‡§æ ‡§Æ‡§æ‡§§‡•ç‡§∞">
  </td>

  <td colspan="2">
    <div class="map-box">
      <span class="map-arrow">‚Üí</span>
      <select class="input" id="production">
        <option value="PROD-01">‡§¨‡§Ç‡§ó‡•Å‡§∞ ‡§™‡§æ‡§≤‡§®</option>
        <option value="PROD-02">‡§¨‡§æ‡§ñ‡•ç‡§∞‡§æ ‡§™‡§æ‡§≤‡§®</option>
      </select>
      <input class="input percent" type="number" id="ratio" value="100">
      %
    </div>
  </td>

  <td>
    <button class="btn btn-save" onclick="saveExpense()">Save</button>
  </td>
</tr>
</tbody>
</table>

<!-- ===== LIST TABLE ===== -->
<table>
<thead>
<tr>
  <th>#</th>
  <th>‡§ñ‡§∞‡•ç‡§ö</th>
  <th>‡§™‡•ç‡§∞‡§ï‡§æ‡§∞</th>
  <th>‡§∞‡§ï‡§Æ</th>
  <th>‡§Ü‡§Ø‡•Å</th>
  <th>Mapping</th>
  <th>Action</th>
</tr>
</thead>
<tbody id="expenseList"></tbody>
</table>

<script>
/* ================= LOGIC (LOCKED) ================= */

let expenses = [];
let editId = null;

function toggleLife() {
  const type = document.getElementById("type").value;
  document.getElementById("life").disabled = (type === "variable");
}

function saveExpense() {
  const title = titleEl().value;
  const type = typeEl().value;
  const amount = Number(amountEl().value);
  const life = Number(lifeEl().value);
  const prod = productionEl().value;
  const ratio = Number(ratioEl().value) || 100;

  if (!title || !amount) {
    alert("‡§ñ‡§∞‡•ç‡§ö ‡§∂‡•Ä‡§∞‡•ç‡§∑‡§ï ‡§∞ ‡§∞‡§ï‡§Æ ‡§Ö‡§®‡§ø‡§µ‡§æ‡§∞‡•ç‡§Ø ‡§õ");
    return;
  }

  const data = {
    id: editId || Date.now(),
    title,
    type,
    amount,
    asset_life: type === "fixed" ? life : null,
    production_map: [
      { production_id: prod, ratio }
    ]
  };

  if (editId) {
    expenses = expenses.map(e => e.id === editId ? data : e);
    editId = null;
  } else {
    expenses.push(data);
  }

  clearForm();
  renderExpenses();
}

function renderExpenses() {
  const tbody = document.getElementById("expenseList");
  tbody.innerHTML = "";

  expenses.forEach((e, i) => {
    const m = e.production_map[0];
    tbody.innerHTML += `
      <tr>
        <td>${i + 1}</td>
        <td>${e.title}</td>
        <td>${e.type === "fixed" ? "‡§∏‡•ç‡§•‡§ø‡§∞" : "‡§ö‡§æ‡§≤‡•Å"}</td>
        <td>${e.amount}</td>
        <td>${e.asset_life || "-"}</td>
        <td>‚Üí ${m.production_id} (${m.ratio}%)</td>
        <td>
          <button class="btn btn-edit" onclick="editExpense(${e.id})">Edit</button>
          <button class="btn btn-del" onclick="deleteExpense(${e.id})">Del</button>
        </td>
      </tr>
    `;
  });
}

function editExpense(id) {
  const e = expenses.find(x => x.id === id);
  if (!e) return;

  titleEl().value = e.title;
  typeEl().value = e.type;
  amountEl().value = e.amount;
  lifeEl().value = e.asset_life || "";
  productionEl().value = e.production_map[0].production_id;
  ratioEl().value = e.production_map[0].ratio;

  toggleLife();
  editId = id;
}

function deleteExpense(id) {
  if (!confirm("Delete ‡§ó‡§∞‡•ç‡§®‡•á ?")) return;
  expenses = expenses.filter(e => e.id !== id);
  renderExpenses();
}

function clearForm() {
  titleEl().value = "";
  amountEl().value = "";
  lifeEl().value = "";
  ratioEl().value = 100;
  typeEl().value = "variable";
  toggleLife();
}

/* ===== helpers ===== */
const titleEl = () => document.getElementById("title");
const typeEl = () => document.getElementById("type");
const amountEl = () => document.getElementById("amount");
const lifeEl = () => document.getElementById("life");
const productionEl = () => document.getElementById("production");
const ratioEl = () => document.getElementById("ratio");

toggleLife();
</script>

</body>
</html>
