<!DOCTYPE html>
<html lang="ne">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1">
<title>Letters | FarmerBase BP Engine</title>

<style>
*{box-sizing:border-box}
body{margin:0;font-family:system-ui;background:#f4f6f8;color:#222}
:root{--w:900px;--g:#1b5e20;--b:#ddd}

/* HEADER */
.header{background:#fff;border-bottom:1px solid var(--b)}
.header-inner{max-width:var(--w);margin:auto;padding:14px}
.header h1{margin:0;font-size:20px}
.header p{margin:6px 0 0;color:#555;font-size:13px}

/* MAIN */
.main{max-width:var(--w);margin:auto;padding:20px}

/* CARD */
.card{
  background:#fff;border:1px solid var(--b);
  border-radius:10px;padding:16px;margin-bottom:20px
}
.card h2{margin-top:0;font-size:18px;color:var(--g)}

.btn{
  padding:6px 14px;border-radius:20px;
  border:1px solid #ccc;background:#1b5e20;
  color:#fff;cursor:pointer;font-size:13px;margin-right:6px
}
.btn.light{background:#eee;color:#222}
.btn.danger{background:#b71c1c;border-color:#b71c1c}

table{width:100%;border-collapse:collapse;margin-top:10px}
th,td{border:1px solid #ddd;padding:8px;font-size:13px;text-align:left}
th{background:#f3f5f7}

.small{font-size:12px;color:#555}
</style>
</head>

<body>

<div class="header">
  <div class="header-inner">
    <h1>üìÑ ‡§®‡§ø‡§µ‡•á‡§¶‡§®‡§π‡§∞‡•Ç (Letters)</h1>
    <p>‡§¨‡§®‡§æ‡§á‡§è‡§ï‡§æ ‡§∏‡§¨‡•à ‡§®‡§ø‡§µ‡•á‡§¶‡§®‡§π‡§∞‡•Ç‡§ï‡•ã ‡§∏‡•Ç‡§ö‡•Ä</p>
  </div>
</div>

<div class="main">

<div class="card">
  <button class="btn" onclick="createNew()">‚ûï ‡§®‡§Ø‡§æ‡§Å ‡§®‡§ø‡§µ‡•á‡§¶‡§® ‡§¨‡§®‡§æ‡§â‡§®‡•Å‡§π‡•ã‡§∏‡•ç</button>
  <button class="btn light" onclick="location.href='index.html'">‚¨ÖÔ∏è Home</button>

  <table>
    <thead>
      <tr>
        <th>‡§ï‡§æ‡§∞‡•ç‡§Ø‡§æ‡§≤‡§Ø</th>
        <th>‡§µ‡§ø‡§∑‡§Ø</th>
        <th>‡§Ö‡§®‡•ç‡§§‡§ø‡§Æ ‡§∏‡§ö‡•ç‡§Ø‡§æ‡§á‡§è‡§ï‡•ã</th>
        <th>‡§ï‡§æ‡§∞‡•ç‡§Ø</th>
      </tr>
    </thead>
    <tbody id="list"></tbody>
  </table>

  <div id="empty" class="small" style="margin-top:10px"></div>
</div>

</div>

<script>
/* ========= BUSINESS ========= */
const B = JSON.parse(localStorage.getItem("fb_businesses")||"{}");
const BID = B.activeId || "b1";

/* ========= STORAGE ========= */
const KEY = "fb_letters_list_"+BID;
let letters = JSON.parse(localStorage.getItem(KEY)||"[]");

/* ========= RENDER ========= */
function render(){
  list.innerHTML="";
  if(letters.length===0){
    empty.textContent="‡§π‡§æ‡§≤‡§∏‡§Æ‡•ç‡§Æ ‡§ï‡•Å‡§®‡•à ‡§®‡§ø‡§µ‡•á‡§¶‡§® ‡§¨‡§®‡§æ‡§á‡§è‡§ï‡•ã ‡§õ‡•à‡§®‡•§";
    return;
  }
  empty.textContent="";

  letters.forEach((l,i)=>{
    list.innerHTML+=`
      <tr>
        <td>${l.office||"-"}</td>
        <td>${l.subject||"-"}</td>
        <td>${new Date(l.updated).toLocaleString()}</td>
        <td>
          <button class="btn light" onclick="openLetter(${i})">‡§ñ‡•ã‡§≤‡•ç‡§®‡•Å‡§π‡•ã‡§∏‡•ç</button>
          <button class="btn danger" onclick="removeLetter(${i})">Delete</button>
        </td>
      </tr>
    `;
  });
}

/* ========= CREATE ========= */
function createNew(){
  const id = Date.now();
  letters.unshift({
    id,
    office:"",
    subject:"",
    updated:new Date().toISOString()
  });
  localStorage.setItem(KEY,JSON.stringify(letters));
  localStorage.setItem("fb_active_letter_"+BID,id);
  location.href="create-letter.html";
}

/* ========= OPEN ========= */
function openLetter(i){
  localStorage.setItem("fb_active_letter_"+BID,letters[i].id);
  location.href="create-letter.html";
}

/* ========= DELETE ========= */
function removeLetter(i){
  if(confirm("‡§Ø‡•ã ‡§®‡§ø‡§µ‡•á‡§¶‡§® delete ‡§ó‡§∞‡•ç‡§®‡•á ‡§π‡•ã ?")){
    letters.splice(i,1);
    localStorage.setItem(KEY,JSON.stringify(letters));
    render();
  }
}

render();
</script>

</body>
</html>
